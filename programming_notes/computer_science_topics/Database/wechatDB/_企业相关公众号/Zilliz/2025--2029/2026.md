
# 01

深度解读：从Two Sum到 Kafka 再到Milvus与iceberg，数据库寻址中，计算永远优于查找 https://mp.weixin.qq.com/s/JGC2qDJvNqzyeZMpF97AuQ  【`1.20`】
- > 03 分布式存储的寻址升级
  * > （1）HDFS的核心优化：元数据不落盘，全部放内存
    + > HDFS的寻址核心是NameNode，它把所有文件的元数据（目录树、文件→块的映射、块→数据节点的映射）全部加载在内存中，而且这些元数据的核心存储结构，就是我们上文讲的HashMap
    + > 其核心数据结构如下：
  * > （2）HDFS的寻址过程（读取大文件某位置）
    + > 核心思想：先计算出数据块的编号，再通过内存映射找到节点，用计算+内存查表替代磁盘遍历。
    + > 比如读取 `/user/data/bigfile.txt` 的200MB位置，全程只有4步：
      ```console
      1. 客户端向NameNode发起1次RPC请求，获取文件的块位置信息；
      2. NameNode在内存中完成路径解析+块映射查找（不触发磁盘IO），计算出200MB落在第2个块（默认块大小128MB）；
      3. NameNode返回该块的存储节点列表（比如DN2、DN3）；
      4. 客户端直连最近的DN2，直接读取该块数据。
      ```
    + > 寻址成本为：1次RPC + 若干次内存查找 + 1次数据读取。过程中，所有元数据全在内存，所有查找都是内存级的O(1)操作，不落盘就是最大的优化；
- > 04 现代存储系统的演进：从能找到，到找得极致高效
  * > 比如一次S3的GET请求，固定延迟约50ms，哪怕只读取1KB的数据，耗时也是50ms；如果一次查询要发起10000次这样的请求，串行耗时就是500秒——这就是小文件爆炸的致命问题。
  * > 这一部分，我们拆解Milvus（向量数据库）、Iceberg（湖仓一体）两个现代存储系统的演进，看它们如何解决行业核心痛点，这也是当前存储架构设计的最优实践，所有优化都没有脱离我们开篇的核心公式和三大心法。
  * > 4.2 Iceberg：湖仓一体的终极寻址设计，分层元数据+统计剪枝，跳过95%的无效文件
    + > Iceberg是当前湖仓一体的事实标准，它解决的是海量数据的复杂条件查询问题，核心痛点是：如何在数千个数据文件中，快速找到符合查询条件的少量文件，避免全量扫描。
    + > 其核心数据结构如下
    + > Iceberg的核心创新，是分层元数据+文件级统计信息，完美落地了我们开篇的剪枝心法，核心逻辑是：在读取数据前，先通过元数据算出「哪些文件需要读、哪些文件可以直接跳过」，从根源减少无效IO。
    + > (1)Iceberg的寻址过程（精准剪枝）
      - > 比如查询：`SELECT * FROM orders WHERE date='2024-01-15' AND amount>1000`，全程只有4步，层层过滤：
        ```console
        1. 读metadata.json（1次IO）：获取当前快照和清单文件列表；
        2. 读Manifest List（1次IO）：过滤掉无关分区（比如2023年的数据）；
        3. 读Manifest Files（2次IO）：通过文件的统计信息（min/max date、min/max amount），过滤掉所有不满足条件的文件；
        4. 读数据文件（3次IO）：只读取最终筛选出的3个文件。
        ```
      - > 与此前的要读取全部1000个文件，IO次数1000的方式比，有了Iceberg：我们仅需7次IO，直接减少94%的无效访问。
      - > 核心思想：统计信息是最好的剪枝刀。写入时花少量成本收集文件的min/max、分区等统计信息，读取时就能用这些信息做前置判断，精准跳过不可能命中的文件，这是计算的极致体现。
- > 05 四种存储系统寻址设计对比与共性总结
  * > 事实上，从一道算法题，到HashMap，再到分布式存储、现代湖仓一体系统，我们看遍了寻址的演进，但所有的优化都没有脱离3个核心原则：
    + > 原则一：计算永远优于查找，这是寻址的第一性原理
    + > 原则二：最小化高延迟访问次数
    + > 原则三：统计信息，是性价比最高的剪枝利器

不会做RAG、agent的本地数据管理？都来学Claude Code！附深度拆解 https://mp.weixin.qq.com/s/9OJnRhtWzz7MtwP9XRJxKA  【`1.12`】

都有混合检索与智能路由了，谁还在给RAG赛博哭坟？ https://mp.weixin.qq.com/s/ErlEzWK-_hzYh8IuyYf4SQ  【`1.8`】
