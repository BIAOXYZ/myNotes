
# 12

需要多久才能看完linux内核源码？ https://mp.weixin.qq.com/s/VTaPwPVHTyUKMzoZI4xzEw
- > 一、内核行数
  * > Linux内核分为`CPU调度`、`内存管理`、`网络`和`存储`四大子系统，针对硬件的驱动成百上千。代码的数量更是大的惊人。
  * > 来看看最新的内核代码量的统计。
    + > 截至`2025年11月28日`，Linux内核Git源码树中的代码达到了`37,020,481行`。
  * > 从统计数据来看，Linux内核源码树共有：
    + > `48,633,608行`(包括文档、Kconfig文件、树中的用户空间实用程序等)、
    + > `1398643次`commit
    + > 总计`31042名`贡献者
  * > Linux内核从最初的10000行代码到现在的4000万行代码就是全球精英共同贡献的结果。***按照一天一万行的速度，也需要4000天，也需要11年多***。这还是建立在所有单次都认识，所有代码逻辑看了的都懂，而且都不忘记的基础上。***实际上即使我们真的看完了，几年后内核又会有非常大的变化，可以说一辈子都看不完Linux内核的代码***。
  * > Linux内核Git源码树中的代码达到了4000万行，核心代码只有`2%`是由`李纳斯•托瓦兹`自己编写的，其他均是其他个人和组织贡献的，李纳斯•托瓦兹公开了Linux但保留了选择新代码和需要合并的新方法的最终裁定权。除了Linus Torvalds，对内核贡献最多的是`David S.Miller、 Mark Brown、Takashi Iwai、Arnd Bergmann、Al Viro和Mauro Carvalho Chehab`。而参与贡献的公司，从域名统计来看，`谷歌`、`Intel`与`Red Hat`排在了最前列。
- > 二、内核目录文件大小
  * > 然而，现在的内核已经膨胀的不成样子了，以还不算最新的linux-4.1.15为例：
  * > 整个内核源码一共约 793M：
  * > 驱动代码占了大概一半，大约380M:
  * > 体系相关的代码大约134M：
  * > 网路子系统相关的代码26M：
  * > 文件系统相关的代码37M:
  * > linux内核核心代码大约6.8M:
- > 三、内核子系统
  * > linux内核代码涉及知识点包括汇编指令、c语言、硬件组成原理、操作系统、数据结构和算法、各种外设总线、驱动、网络协议栈。
  * > 直接对硬件操作是非常复杂的。所以内核通常提供一种硬件抽象的方法，来完成这些操作。通过进程间通信机制及系统调用，应用进程可间接控制所需的硬件资源（特别是处理器及IO设备）。
  * > ![](https://mmbiz.qpic.cn/mmbiz_png/icRxcMBeJfcibGMuiamgfuIcyw97XQQWtEUbSWcXyuLnPaluZlgQiamO6Bbge2aoPrpHvtVPWedp6ZbI1FVomLo1wg/640)
  * > 最上面是用户（或应用程序）空间。这是用户应用程序执行的地方。用户空间之下是内核空间，Linux 内核正是位于这里。
  * > GNU C Library （glibc）也在这里。它提供了连接内核的系统调用接口，还提供了在用户空间应用程序和内核之间进行转换的机制。
  * > 内核和用户空间的应用程序使用的是不同的保护地址空间。
  * > 每个用户空间的进程都使用自己的虚拟地址空间，而内核则占用单独的地址空间。
  * > Linux 内核可以进一步划分成 3 层。最上面是系统调用接口，它实现了一些基本的功能，例如 read 和 write。系统调用接口之下是内核代码，可以更精确地定义为独立于体系结构的内核代码。这些代码是 Linux 所支持的所有处理器体系结构所通用的。在这些代码之下是依赖于体系结构的代码，构成了通常称为 BSP（Board Support Package）的部分。这些代码用作给定体系结构的处理器和特定于平台的代码。
  * > 内核主要系统包括：SCI：系统调用接口 PM：进程管理 VFS：虚拟文件系统 MM：内存管理 Network Stack：内核协议栈 Arch：体系架构 DD：设备驱动
- > 四、如何学习内核？

# 09

腾讯面试官问：如何用 1GB 内存去重 40亿 QQ号？答案竟然是... https://mp.weixin.qq.com/s/02Oiyu5Xe2qLTbSXH1R4_g
- > 解决方案一：位图（Bitmap）方法
- > 解决方案二：使用布隆过滤器

# 01

二十年铸就信赖：GBase 8s数据库创新发展之道 https://mp.weixin.qq.com/s/SqYBQ0EV99s5kdEpFZqb5A
- > `GBASE南大通用`作为国产数据库领域的关键厂商，其首款通过安全可靠测评的事务型数据库GBase 8s是国产数据库创新发展的代表产品。近期，我们与GBASE南大通用`GBase 8s`产品部部长郭茁进行了线上直播交流，讨论了GBase 8s发展历程、用户需求与选型、未来规划等相关问题。
- > **多版本并发控制**
  * > 多版本并发控制(MVCC)在很多数据库产品上已经成为了提高并发性的基础能力，***GBase 8s目前使用`悲观锁`机制来实现该能力。MVCC的机制在`读多写少`的场景下并发性会更好，处理能力会更强，GBase 8s未来会通过MVCC技术更好地利用NUMA架构下的最大算力***。

国产数据库崛起正当时，2024年数据库风云回顾 https://mp.weixin.qq.com/s/qvIL1F-1NSOs7d3pzq622Q
- > **在数据安全领域**，随着国家对数据安全愈发重视，数据库内置安全能力成为标配，包括数据传输、数据存储、安全使用等三方面为代表。多款数据库都通过最高等级的安全认证。

只因把 https 改成 http，带宽减少了 70%！ https://mp.weixin.qq.com/s/OwAGT-ppR51QYTHCLlyu5g
- > **起因**
  * > 是一个高并发的采集服务上线后，100m的上行很快就被打满了。
  * > 因为这是一条专线，并且只有这一个服务在使用，所以可以确定就是它导致的。
  * > 但是这个请求只是一个 GET 请求，同时并没有很大的请求体，这是为什么呢？
  * > 于是使用 `charles` 重新抓包后发现，一个 request 的请求居然要占用 1.68kb 的大小!
  * > 其中 `TLS Handshake` 就占了 1.27kb。
  * > 这种情况下，需要的上行带宽就是：`1.68*20000/1024*8=262.5mbps`
  * > 也就说明 `100mbps` 的上行为何被轻松打满
- > **`TLS Handshake` 是什么来头，竟然如此大?**
  * > 首先要知道 `HTTPS` 全称是：`HTTP over TLS`，***每次建立新的TCP连接通常需要进行一次完整的 `TLS Handshake`。在握手过程中，客户端和服务器需要交换证书、公钥、加密算法等信息，这些数据占用了较多的字节数***。
  * > 因此想到最粗暴的解决方案也比较简单，就是直接使用 HTTP，省去 `TLS Handshake` 的过程，那么自然就不会有 TLS 的传输了。
- > **那么问题来了**
  * > 如果接口必须使用 https 那怎么办呢?
  * > 当然还有另外一个解决方案，那就使用使用 `Keep-Alive`。
  * > headers 中添加 `Connection: keep-alive` 即可食用。
  * > ***通过启用 `Keep-Alive`，可以在同一TCP连接上发送多个HTTPS请求，而无需每次都进行完整的 `TLS Handshake`，但第一次握手时仍然需要传输证书和完成密钥交换***。
  * > 对于高并发的场景也非常适用。
- > **要注意的是**
  * > `keep-alive` 是有超时时间的，超过时间连接会被关闭，再次请求需要重新建立链接。
  * > Nginx 默认的 `keep-alive` 超时是 75 秒，Apache HTTP 服务器 通常默认的 `keep-alive` 超时是 5 秒。ps：如果你的采集程序使用了大量的代理 ip 那么 `keep-alive` 的效果并不明显～～最好的还是使用 http
